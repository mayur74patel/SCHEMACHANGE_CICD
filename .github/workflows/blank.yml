name: snowflake-devops-demo

on:
    push:
        branches:
            - main
        paths:
            - 'dbscripts/**'
    
    workflow_dispatch:

jobs:
    deploy-snowflake-change-jobs:
        runs-on: ubuntu-latest
    steps:
        - name: Checkout repository
          uses: actions/setup-python@v2.2.1
          with:
            python-version: 3.8.x
        
        - name: Run schemachange
          env:
            SF_ACCOUNT: ${{ sercrets.SF_ACCOUNT}}
            SF_USERNAME: ${{ sercrets.SF_USERNAME}}
            SF_ROLE: ${{ sercrets.SF_ROLE}}
            SF_WAREHOUSE: ${{ sercrets.SF_WAREHOUSE}}
            SF_DATABASE: ${{ sercrets.SF_DATABASE}}
            SNOWFLAKE_PASSWORD: ${{ sercrets.SF_PASSWORD}}
          run: |
            echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
            python --version
            echo "Step 1: Installing schemachange"
            pip install schemachange
            
            echo "Step 2: Running schemachange"
            schemachange -f $GITHUB_WORKSPACE/dbscripts -a $SF_ACCOUNT -u $SF_USERNAME -r $SF_ROLE -w $SF_WAREHOUSE -d $SF_DATABASE -c $SF_DATABASE.SCHEMACHANGE.CHANGE_HISTORY --create-change-history-table
            
            
            
            
